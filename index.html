<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <!-- Viewport optimizado para iPad: permite zoom del usuario pero no auto-zoom -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>PsicoTrain - Entrenador de PsicotÃ©cnicos</title>
    <meta name="description" content="AplicaciÃ³n interactiva para practicar ejercicios psicotÃ©cnicos de oposiciones">

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PsicoTrain">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <!-- iOS Safari optimizations -->
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registrado'))
                    .catch(err => console.log('Error SW:', err));
            });
        }
    </script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-text">
                    <span class="logo-icon">ğŸ§ </span>
                    <h1>PsicoTrain</h1>
                </div>
                <button id="toggleSidebar" class="sidebar-toggle-btn" title="Contraer/Expandir menÃº"
                    onclick="toggleSidebar()">
                    <span>â—€</span>
                </button>
            </div>

            <nav class="categories-nav">
                <h2>CategorÃ­as</h2>
                <ul id="categoriesList">
                    <!-- Se llena dinÃ¡micamente -->
                </ul>
            </nav>

            <!-- Sidebar Actions -->
            <div class="sidebar-actions">
                <button class="sidebar-btn" onclick="showUploadPanel()">
                    <span>ğŸ“„</span> Cargar PDFs
                </button>
                <button class="sidebar-btn" onclick="showNotesPanel()">
                    <span>ğŸ“’</span> Trucos y Notas
                </button>
            </div>


        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="breadcrumb" id="breadcrumb">
                    <span>Selecciona una categorÃ­a para comenzar</span>
                </div>
                <div class="header-actions">
                    <button class="btn-icon" onclick="toggleDarkMode()" title="Modo oscuro">ğŸŒ™</button>
                    <button class="btn-icon" onclick="showHelp()" title="Ayuda">â“</button>
                </div>
            </header>

            <!-- Welcome Screen -->
            <section id="welcomeScreen" class="welcome-screen">
                <div class="welcome-content">
                    <h2>Â¡Bienvenido a PsicoTrain!</h2>
                    <p>Tu entrenador personal para ejercicios psicotÃ©cnicos</p>



                    <p class="cta-text">ğŸ‘ˆ Selecciona una categorÃ­a en el menÃº lateral para empezar</p>
                </div>
            </section>

            <!-- Exercise List Screen -->
            <section id="exerciseListScreen" class="exercise-list-screen hidden">
                <div class="exercise-grid" id="exerciseGrid">
                    <!-- Se llena dinÃ¡micamente -->
                </div>
            </section>

            <!-- Exercise Viewer Screen -->
            <section id="exerciseViewerScreen" class="exercise-viewer-screen hidden">
                <!-- Top Bar -->
                <div class="viewer-top-bar">
                    <button class="back-btn-inline" onclick="goBackToList()">â† Volver</button>

                    <div class="stopwatch-container">
                        <span id="stopwatchDisplay" class="stopwatch-display">00:00</span>
                        <div class="stopwatch-controls">
                            <button id="toggleStopwatch" class="stopwatch-btn" onclick="toggleStopwatch()"
                                title="Pausar/Reanudar">â¸</button>
                            <button id="resetStopwatch" class="stopwatch-btn" onclick="resetStopwatch()"
                                title="Reiniciar">ğŸ”„</button>
                        </div>
                    </div>

                    <div class="viewer-navigation">
                        <div class="nav-pages">
                            <button class="nav-btn" id="prevPageBtn" onclick="prevPage()">â—€</button>
                            <span class="page-indicator" id="pageIndicator">PÃ¡gina 1 de 1</span>
                            <button class="nav-btn" id="nextPageBtn" onclick="nextPage()">â–¶</button>
                        </div>

                        <div class="nav-zoom">
                            <button class="nav-btn zoom-btn" onclick="zoomOut()" title="Reducir">â–</button>
                            <button class="nav-btn zoom-btn" onclick="zoomIn()" title="Aumentar">â•</button>
                            <button class="nav-btn zoom-btn" onclick="resetZoom()" title="Restablecer">â†º</button>
                        </div>
                    </div>

                    <div class="viewer-actions">
                        <button class="tool-btn" id="toggleQuickNotesBtn" onclick="toggleQuickNotes()"
                            title="Notas rÃ¡pidas">ğŸ“</button>
                        <div class="drawing-toggle"> <button class="tool-btn" id="toggleDrawing"
                                onclick="toggleDrawingMode()" title="Modo dibujo">ğŸ¨</button>
                        </div>
                    </div>
                </div>

                <!-- Drawing Toolbar (shows when drawing mode enabled) -->
                <div class="drawing-toolbar hidden" id="drawingToolbar">
                    <button class="tool-btn active" id="toolPen" onclick="setTool('pen')" title="LÃ¡piz">âœï¸</button>
                    <button class="tool-btn" id="toolHighlighter" onclick="setTool('highlighter')"
                        title="Marcador">ğŸ–ï¸</button>
                    <button class="tool-btn" id="toolEraser" onclick="setTool('eraser')" title="Borrador">ğŸ§½</button>
                    <div class="color-picker">
                        <button class="color-btn active" style="background:#ef4444"
                            onclick="setColor('#ef4444')"></button>
                        <button class="color-btn" style="background:#3b82f6" onclick="setColor('#3b82f6')"></button>
                        <button class="color-btn" style="background:#22c55e" onclick="setColor('#22c55e')"></button>
                        <button class="color-btn" style="background:#f59e0b" onclick="setColor('#f59e0b')"></button>
                        <button class="color-btn" style="background:#000000" onclick="setColor('#000000')"></button>
                        <button class="color-btn" style="background:#ffffff" onclick="setColor('#ffffff')"></button>
                    </div>
                    <div class="brush-size-control">
                        <span class="size-label">Grosor:</span>
                        <input type="range" id="brushSize" min="1" max="30" value="4"
                            oninput="setBrushSize(this.value)">
                        <span class="size-value" id="brushSizeValue">4</span>
                    </div>
                    <button class="tool-btn" onclick="clearDrawing()" title="Limpiar">ğŸ—‘ï¸</button>
                </div>

                <!-- Main Content: Viewer + Answers Panel -->
                <div class="viewer-layout">
                    <!-- Image Viewer (Left) -->
                    <div class="image-container" id="imageContainer">
                        <div class="image-wrapper" id="imageWrapper">
                            <img id="exerciseImage" src="" alt="Ejercicio">
                            <canvas id="drawingCanvas"></canvas>
                        </div>
                    </div>

                    <!-- Answers Panel (Right) -->
                    <div class="answers-panel" id="answersPanel">
                        <div class="answers-header">
                            <h3>ğŸ“ Respuestas</h3>
                            <button class="btn-small" onclick="clearPageAnswers()">Limpiar</button>
                        </div>
                        <div class="answers-list" id="answersList">
                            <!-- Se genera dinÃ¡micamente con JavaScript -->
                        </div>
                        <div class="answers-footer">
                            <button class="btn-small" onclick="addMoreQuestions()">+ MÃ¡s</button>
                            <span class="question-count" id="questionCount">10 preguntas</span>
                        </div>
                    </div>
                </div>
    </div>
    </section>

    <!-- Quick Notes Panel (Floating) -->
    <div class="quick-notes-panel hidden" id="quickNotesPanel">
        <div class="notes-titlebar" id="notesTitlebar">
            <h4>ğŸ““ Notas RÃ¡pidas</h4>
            <div class="notes-controls">
                <button class="notes-mode-btn active" data-mode="text" onclick="switchNotesMode('text')"
                    title="Modo texto">âœï¸</button>
                <button class="notes-mode-btn" data-mode="draw" onclick="switchNotesMode('draw')"
                    title="Modo dibujo">ğŸ¨</button>
                <button class="notes-clear-btn" onclick="clearNotesCanvas()" title="Limpiar dibujo">ğŸ—‘ï¸</button>
                <button class="notes-close-btn" onclick="toggleQuickNotes()">Ã—</button>
            </div>
        </div>
        <div class="notes-content-area" id="notesContentArea">
            <textarea class="notes-textarea notebook-lines" id="quickNotesTextarea"
                placeholder="Escribe tus notas aquÃ­..."></textarea>
            <canvas class="notes-canvas hidden" id="quickNotesCanvas"></canvas>
        </div>
        <div class="notes-resize-handle" id="notesResizeHandle"></div>
    </div>
    </main>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close" onclick="closeHelp()">Ã—</button>
            <h2>Ayuda</h2>
            <div class="help-content">
                <h3>Â¿CÃ³mo usar PsicoTrain?</h3>
                <ol>
                    <li>Selecciona una <strong>categorÃ­a</strong> en el menÃº lateral</li>
                    <li>Elige un <strong>tipo de ejercicio</strong></li>
                    <li>Navega por las pÃ¡ginas del ejercicio</li>
                    <li>Marca tus <strong>respuestas</strong> en el panel derecho</li>
                    <li>Usa ğŸ¨ para activar el modo dibujo</li>
                </ol>

                <h3>Controles</h3>
                <ul>
                    <li><strong>â† â†’</strong> Navegar entre pÃ¡ginas</li>
                    <li><strong>+/-</strong> Zoom en la imagen</li>
                    <li><strong>ğŸ¨</strong> Activa el modo dibujo para anotar</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Upload PDF Modal -->
    <div id="uploadModal" class="modal hidden">
        <div class="modal-content modal-large">
            <button class="modal-close" onclick="closeUploadPanel()">Ã—</button>
            <h2>ğŸ“„ Cargar PDFs</h2>
            <div class="upload-content">
                <p>Arrastra PDFs aquÃ­ o haz clic para seleccionar:</p>
                <div class="upload-zone" id="uploadZone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)"
                    ondragleave="handleDragLeave(event)">
                    <span class="upload-icon">ğŸ“</span>
                    <p>Arrastra archivos PDF aquÃ­</p>
                    <input type="file" id="pdfInput" accept=".pdf" multiple onchange="handleFileSelect(event)" hidden>
                    <button class="btn-primary" onclick="document.getElementById('pdfInput').click()">Seleccionar
                        archivos</button>
                </div>
                <div class="upload-list" id="uploadList">
                    <!-- Lista de PDFs a cargar -->
                </div>
                <div class="upload-note">
                    <strong>Nota:</strong> Los PDFs se convertirÃ¡n a imÃ¡genes. Este proceso puede tardar unos minutos.
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div id="notesModal" class="modal hidden">
        <div class="modal-content modal-large">
            <button class="modal-close" onclick="closeNotesPanel()">Ã—</button>
            <h2>ğŸ“’ Trucos y Notas</h2>
            <div class="notes-content">
                <div class="notes-categories" id="notesCategories">
                    <button class="note-cat-btn active" onclick="selectNoteCategory('general')">ğŸ“Œ General</button>
                    <button class="note-cat-btn" onclick="selectNoteCategory('percepcion')">ğŸ‘ï¸ PercepciÃ³n</button>
                    <button class="note-cat-btn" onclick="selectNoteCategory('abstracto')">ğŸ§© R. Abstracto</button>
                    <button class="note-cat-btn" onclick="selectNoteCategory('espacial')">ğŸ“ R. Espacial</button>
                    <button class="note-cat-btn" onclick="selectNoteCategory('verbal')">ğŸ“ Verbal</button>
                </div>
                <div class="notes-editor">
                    <textarea id="notesTextarea" placeholder="Escribe tus trucos, atajos y notas aquÃ­..."></textarea>
                </div>
                <div class="notes-actions">
                    <button class="btn-secondary" onclick="clearCurrentNotes()">Limpiar</button>
                    <button class="btn-primary" onclick="saveNotes()">ğŸ’¾ Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>